%{
wrapper_SCEPT
Author: Tom Bullock (adapted from Tyler scripts)
Date: 07.23.18

%}

function wrapper_SCEPT(sjNum,rDir)

%% ADD SUBJECT RULES (these subjects have no task data, only resting)
if sum(strcmp(sjNum,{'sj115','sj116','sj124'}))==1
    taskDataPresent=0;
else
    taskDataPresent=1;
end


%rDir = '/home/bullock/VO2_fMRI/Subject_Data';

%% add analysis scripts folder to path
addpath(genpath('/home/bullock/Scan_CPET/Analysis'))
%spm_rmpath
addpath(genpath('/home/bullock/spm12'))

%% cd to subject data folder and get files
%cd(rDir);
%d=dir('sj*');

%for iSub = 1:1;%length(d)

%% cd to subject folder
thisDir = [rDir '/' num2str(sjNum)];
cd(thisDir);

%% open an SPM session (necessary to save pdf outputs)
spm fmri

%% pre-process ALL fMRI data
%dicomConvert_VO2
%realignEstimateReslice_VO2(taskDataPresent) % 0=no task data, 1=task data (some subs - 115,116,124 - only have resting data)
%segmentStrip_VO2
%brainMask_VO2(0) % 0 = no smoothing, 1 = smoothing
%coregister_anatomical2functional

pre_dicomConvert
pre_realignEstimateReslice
pre_segmentStrip
pre_brainMask
pre_coregister_anatomical2functional


%% pre-process for RESTING state analyses
smoothDataForRestingState(taskDataPresent) % 0=no task data, 1=task data (some subs - 115,116,124 - only have resting data)

% take preprocessed RS data and throw into a 4D nifti file
% Global signal scaling (use median)
% Linear detrending
% Brain Wavelet Toolbox (just resting)
% nus regression (load in the motion params, stored in folder, begin with
% rp...detrend the data)
% filter the data (either bandpass OR with wavelet decomp (both have adv or
% disad)
%% connectivity analysis
%schaefer atlas - github and CC picture

%% close SPM session
close all

% %% organize data and run IEM (subs 112,119,121,125,127,130,133)
% % singleTrialModeling
% % compile_Betas_For_Modeling
% % runIEM_VO2

return
